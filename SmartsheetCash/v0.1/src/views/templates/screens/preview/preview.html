{% extends enums.Template.LAYOUT %}
{% block title %}
	Review Before Commit
{% endblock title %}

{% block breadcrumb_block %}
	{% set data = {
		'items_data': [
			(enums.Route.ANALYZE + '?' + enums.MethodKeys.SHEET_ID + '=' + ctrl_obj.methods[enums.MethodKeys.SHEET_ID] | string 
			+ '&' + enums.MethodKeys.DES_ID + '=' + ctrl_obj.methods[enums.MethodKeys.DES_ID] | string , 'Analyze', False),
            (enums.Route.PREVIEW, 'Commit ', True)
		],
		'home_link':  enums.Route.INDEX
	}
	%}
	{{ breadcrumb(data) }}
{% endblock breadcrumb_block %}

{% block scripts %}
	{{super()}}
	<script src="{{url_for('static', filename='js/screens/preview.js')}}"></script>
{% endblock scripts %}

{% block styles %}
	{{super()}}
	<link rel="stylesheet" href="{{ url_for('static', filename='css/screens/preview.css') }}" />
{% endblock styles %}

{% set unuse = ctrl_obj.get_setting() %}
{% set all_settings = ctrl_obj.all_settings %}
{% set dummy_data = ctrl_obj.create_dummy_data_to_commit() %}
{% block option %}
	{{button({
		'type': 'button',
		'text': "Commit",
		'class': 'custom-button commit',
		'attrs': [('data-sheet-id', ctrl_obj.methods[enums.MethodKeys.SHEET_ID]),
		('data-des-id', ctrl_obj.methods[enums.MethodKeys.DES_ID])]
		})
	}}
	
{% endblock option %}

{% block content %}
	<table class="table table-striped table-bordered position-relative" cellspacing="0" width='100%'>
	  <thead class="custom-position-sticky">
        <tr>
			<th class="custom-w-3 center-text" rowspan='2'>{{checkbox({
				'value': "",
				'class': 'custom-checkbox all-checkbox',
				'attrs': [('data-target', 'tbody')],
				'text': '',
				'id': '',
				})
			}}
			</th>
			<th class="custom-w-5">Action</th>
			<th class="custom-w-3">Row</th>
			<th class="">Attachments</th>
            {% for element in all_settings[enums.ConfigKeys.MAPPING_HEADERS] %}
				{% set src_header, des_header = element %}
                <th class="">{{des_header}}</th>
            {% endfor %}
			{% for mapping_header in all_settings[enums.ConfigKeys.DES_MAPPING_SRC_SHEET] %}
                <th class="">{{mapping_header}}</th>
            {% endfor %}
        </tr>
	  </thead>
	  <tbody>
		{% for row in dummy_data %}
			{% set attachments = row[enums.DataKeys.ATTACHMENTS] %}
			{% set attachments_name = row[enums.DataKeys.ATTACHMENTS_NAME] %}
			{% set row_id = row[enums.DataKeys.ROW_ID] %}
			{% set compare_id = row[enums.DataKeys.COMPARE_ID] %}
			{% set row_number = row[enums.DataKeys.ROW_NUMBER] %}
			{% set action = row[enums.DataKeys.ACTION] %}
			<tr>
				<td class="center-text">
					{{checkbox({
						'value': compare_id,
						'class': 'custom-checkbox',
						'text': '',
						})
					}}
				</td>
				<td class="{{action}}">{{action}}</td>
				<td class="">{{row_number}}</td>
				<td class="">{{ attachments_name | join('<br>') | safe}}</td>
				{% for element in all_settings[enums.ConfigKeys.MAPPING_HEADERS] %}
					{% set src_header, des_header = element %}
					<td class="">{{ row[des_header][enums.DataKeys.VALUE] }}</td>
				{% endfor %}
				{% for mapping_header in all_settings[enums.ConfigKeys.DES_MAPPING_SRC_SHEET] %}
					<td class="">{{ row[mapping_header][enums.DataKeys.VALUE] }}</td>
				{% endfor %}
			</tr>
		{% endfor %}

	  </tbody>
	  
	</table>
{% endblock content%}